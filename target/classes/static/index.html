<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BMS Student Companion - Your College Support System</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Chart.js for progress graph -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bms-blue: #0a2e8a;
            --bms-gold: #d4af37;
            --bms-light: #eef2ff;
            --bms-dark: #1e3a8a;
            --bms-accent: #3b82f6;
            --bms-success: #10b981;
            --bms-warning: #f59e0b;
            --bms-danger: #ef4444;
            --gradient-primary: linear-gradient(135deg, #0a2e8a 0%, #3b82f6 100%);
            --gradient-gold: linear-gradient(135deg, #d4af37 0%, #fbbf24 100%);
            --shadow-soft: 0 4px 20px rgba(10, 46, 138, 0.08);
            --shadow-hard: 0 10px 40px rgba(10, 46, 138, 0.15);
            --radius-sm: 12px;
            --radius-md: 20px;
            --radius-lg: 30px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #eef2ff 100%);
            color: #1f2937;
            min-height: 100vh;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Header Styles */
        .header {
            background: var(--gradient-primary);
            border-radius: var(--radius-lg);
            padding: 25px 40px;
            margin-bottom: 30px;
            color: white;
            box-shadow: var(--shadow-hard);
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="none"><path d="M0,0 L100,0 L100,100 Z" fill="white" opacity="0.05"/></svg>');
            background-size: cover;
        }
        
        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: relative;
            z-index: 2;
        }
        
        .college-branding {
            display: flex;
            align-items: center;
            gap: 25px;
        }
        
        .logo-container {
            width: 100px;
            height: 100px;
            background: white;
            border-radius: 50%;
            padding: 12px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .college-logo {
            width: 75px;
            height: auto;
            filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.1));
        }
        
        .college-info h1 {
            font-family: 'Poppins', sans-serif;
            font-size: 2.4rem;
            font-weight: 700;
            margin-bottom: 5px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .college-info .tagline {
            font-size: 1rem;
            opacity: 0.9;
            font-weight: 300;
            letter-spacing: 0.5px;
        }
        
        .motto {
            font-style: italic;
            font-size: 0.9rem;
            color: var(--bms-gold);
            margin-top: 8px;
            font-weight: 500;
        }
        
        /* Main Layout */
        .main-layout {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 1100px) {
            .main-layout {
                grid-template-columns: 1fr;
            }
        }
        
        /* Sidebar */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        
        .card {
            background: white;
            border-radius: var(--radius-md);
            padding: 25px;
            box-shadow: var(--shadow-soft);
            transition: var(--transition);
            border: 1px solid #e5e7eb;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hard);
            border-color: var(--bms-accent);
        }
        
        .card-title {
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--bms-blue);
            font-family: 'Poppins', sans-serif;
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid #e5e7eb;
        }
        
        .card-title i {
            color: var(--bms-gold);
            font-size: 1.5rem;
        }
        
        .quick-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .quick-btn {
            background: var(--bms-light);
            border: none;
            border-radius: 10px;
            padding: 14px 18px;
            text-align: left;
            font-size: 0.95rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 12px;
            color: #374151;
            font-weight: 500;
        }
        
        .quick-btn:hover {
            background: var(--bms-blue);
            color: white;
            transform: translateX(8px);
        }
        
        .quick-btn:hover i {
            color: var(--bms-gold);
        }
        
        .quick-btn i {
            color: var(--bms-blue);
            font-size: 1.2rem;
            width: 24px;
        }
        
        /* Emergency Card */
        .emergency-card {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            border: 2px solid var(--bms-danger);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }
        
        .emergency-btn {
            background: var(--bms-danger);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 15px;
            width: 100%;
            font-weight: 600;
            font-size: 1.1rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .emergency-btn:hover {
            background: #dc2626;
            transform: scale(1.05);
        }
        
        /* Chat Area */
        .chat-area {
            display: flex;
            flex-direction: column;
            height: 650px;
        }
        
        .chat-header {
            background: var(--gradient-primary);
            color: white;
            padding: 20px 30px;
            border-radius: var(--radius-md) var(--radius-md) 0 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .chat-header h2 {
            font-family: 'Poppins', sans-serif;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .bot-status {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .status-indicator {
            width: 10px;
            height: 10px;
            background: var(--bms-success);
            border-radius: 50%;
            animation: blink 2s infinite;
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .chat-container {
            flex: 1;
            background: white;
            border-radius: 0 0 var(--radius-md) var(--radius-md);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: var(--shadow-soft);
        }
        
        .chat-messages {
            flex: 1;
            padding: 25px;
            overflow-y: auto;
            background: #f8fafc;
        }
        
        .message {
            margin-bottom: 20px;
            max-width: 85%;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .user-message {
            margin-left: auto;
        }
        
        .message-content {
            padding: 16px 20px;
            border-radius: 18px;
            position: relative;
            box-shadow: var(--shadow-soft);
            line-height: 1.6;
        }
        
        .bot-message .message-content {
            background: white;
            border: 1px solid #e5e7eb;
            border-bottom-left-radius: 5px;
            color: #1f2937;
        }
        
        .user-message .message-content {
            background: var(--gradient-primary);
            color: white;
            border-bottom-right-radius: 5px;
        }
        
        .message-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        .bot-message .message-header {
            color: var(--bms-blue);
        }
        
        .user-message .message-header {
            justify-content: flex-end;
            color: white;
        }
        
        .message-time {
            font-size: 0.8rem;
            opacity: 0.7;
            margin-top: 5px;
            text-align: right;
        }
        
        .chat-input-area {
            padding: 20px;
            background: white;
            border-top: 1px solid #e5e7eb;
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .message-input {
            flex: 1;
            padding: 16px 24px;
            border: 2px solid #e5e7eb;
            border-radius: 50px;
            font-size: 1rem;
            font-family: 'Inter', sans-serif;
            transition: var(--transition);
            outline: none;
        }
        
        .message-input:focus {
            border-color: var(--bms-accent);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .send-btn {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: var(--gradient-gold);
            border: none;
            color: var(--bms-blue);
            font-size: 1.3rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .send-btn:hover {
            transform: scale(1.1) rotate(5deg);
            box-shadow: 0 8px 20px rgba(212, 175, 55, 0.3);
        }
        
        /* Feature Cards */
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }
        
        .feature-card {
            background: white;
            border-radius: var(--radius-md);
            padding: 30px;
            box-shadow: var(--shadow-soft);
            transition: var(--transition);
            border: 1px solid #e5e7eb;
        }
        
        .feature-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-hard);
        }
        
        .feature-icon {
            width: 70px;
            height: 70px;
            background: var(--gradient-primary);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            color: white;
            font-size: 1.8rem;
        }
        
        .feature-card h3 {
            color: var(--bms-blue);
            font-family: 'Poppins', sans-serif;
            margin-bottom: 15px;
            font-size: 1.4rem;
        }
        
        .feature-card p {
            color: #6b7280;
            margin-bottom: 20px;
            line-height: 1.7;
        }
        
        .feature-btn {
            background: transparent;
            border: 2px solid var(--bms-blue);
            color: var(--bms-blue);
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .feature-btn:hover {
            background: var(--bms-blue);
            color: white;
        }
        
        /* Study Session Dashboard */
        #studySession {
            display: none;
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            padding: 30px;
            border-radius: var(--radius-md);
            margin: 30px auto;
            max-width: 900px;
            box-shadow: var(--shadow-hard);
            border-left: 6px solid var(--bms-success);
        }
        
        #studySession h3 {
            color: #065f46;
            margin-bottom: 20px;
            font-size: 1.6rem;
        }
        
        #timerDisplay {
            font-size: 3rem;
            font-weight: bold;
            color: #065f46;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
        }
        
        .progress-container {
            background: #e6f7ee;
            border-radius: 10px;
            overflow: hidden;
            height: 30px;
            margin-bottom: 20px;
            position: relative;
        }
        
        #progressBar {
            height: 100%;
            width: 0%;
            background: var(--bms-success);
            transition: width 0.8s ease;
        }
        
        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-weight: bold;
            color: #065f46;
            text-shadow: 1px 1px 2px rgba(255,255,255,0.8);
        }
        
        /* Timetable Generator */
        .timetable-generator {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border: 2px dashed var(--bms-accent);
        }
        
        .timetable-input {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .timetable-input input {
            flex: 1;
            padding: 12px 18px;
            border: 2px solid #cbd5e1;
            border-radius: 10px;
            font-size: 1rem;
        }
        
        .timetable-btn {
            background: var(--gradient-gold);
            color: var(--bms-blue);
            border: none;
            border-radius: 10px;
            padding: 12px 24px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .timetable-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 15px rgba(212, 175, 55, 0.3);
        }
        
        /* Footer */
        .footer {
            text-align: center;
            padding: 30px;
            margin-top: 40px;
            color: #6b7280;
            font-size: 0.9rem;
            border-top: 1px solid #e5e7eb;
        }
        
        .footer-links {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 20px;
        }
        
        .footer-link {
            color: var(--bms-blue);
            text-decoration: none;
            transition: var(--transition);
        }
        
        .footer-link:hover {
            color: var(--bms-gold);
            text-decoration: underline;
        }
        
        /* Special Message Styles */
        .peer-message .message-content {
            background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
            border-left: 4px solid var(--bms-success);
        }
        
        /* Response formatting */
        .response-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        
        .response-table th {
            background: var(--bms-blue);
            color: white;
            padding: 12px;
            text-align: left;
        }
        
        .response-table td {
            padding: 12px;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .response-table tr:last-child td {
            border-bottom: none;
        }
        
        .subject-chip {
            display: inline-block;
            background: var(--bms-light);
            padding: 6px 12px;
            border-radius: 20px;
            margin: 3px;
            font-size: 0.9rem;
            color: var(--bms-blue);
            font-weight: 500;
        }
        
        /* Loader */
        .loader {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--bms-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Quick Info Cards */
        .info-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .info-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid var(--bms-accent);
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
        }
        
        .info-card h5 {
            color: var(--bms-blue);
            margin-bottom: 8px;
            font-size: 0.9rem;
        }
        
        .info-card p {
            font-size: 0.85rem;
            color: #6b7280;
        }
        
        /* Typing indicator */
        .typing-indicator {
            display: none;
            padding: 10px 20px;
            background: white;
            border-radius: 18px;
            border-bottom-left-radius: 5px;
            width: fit-content;
            margin-bottom: 20px;
            box-shadow: var(--shadow-soft);
        }
        
        .typing-dots {
            display: flex;
            gap: 5px;
        }
        
        .typing-dots span {
            width: 8px;
            height: 8px;
            background: var(--bms-blue);
            border-radius: 50%;
            animation: typing 1.4s infinite ease-in-out;
        }
        
        .typing-dots span:nth-child(1) { animation-delay: -0.32s; }
        .typing-dots span:nth-child(2) { animation-delay: -0.16s; }
        
        @keyframes typing {
            0%, 80%, 100% { transform: scale(0); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="college-branding">
                    <div class="logo-container">
                        <img src="https://th.bing.com/th/id/OIP.jlBzFsGL1j13RuIbg1p65QHaHV?w=159&h=211&c=8&rs=1&qlt=90&o=6&pid=3.1&rm=2" 
                             alt="BMS College Logo" class="college-logo">
                    </div>
                    <div class="college-info">
                        <h1>BMS College of Engineering</h1>
                        <div class="tagline">Autonomous Institute under VTU | Estd. 1946</div>
                        <div class="motto">"‡≤∏‡≤§‡≥ç‡≤Ø‡≤Ç ‡≤µ‡≤¶ ‡≤ß‡≤∞‡≥ç‡≤Æ‡≤Ç ‡≤ö‡≤∞" - Speak the Truth, Practice Righteousness</div>
                    </div>
                </div>
                <div class="bot-identity">
                    <h3>ü§ñ Student Support Companion</h3>
                    <div class="bot-status">
                        <span class="status-indicator"></span>
                        <span>Online & Ready to Help</span>
                    </div>
                </div>
            </div>
        </header>
        
        <!-- Active Study Session Dashboard (hidden by default) -->
        <div id="studySession">
            <h3>üë• Active Peer Study Session - ID: <span id="sessionIdDisplay"></span></h3>
            <p>Subjects: <span id="subjectsDisplay"></span></p>
            <p>Time Remaining: <span id="timerDisplay">00:00</span></p>
            <div class="progress-container">
                <div id="progressBar"></div>
                <div class="progress-text" id="progressText">0%</div>
            </div>
            <h4 style="margin: 20px 0 10px; color: #065f46;">Progress Over Time</h4>
            <canvas id="progressChart" height="200"></canvas>
            <button class="feature-btn" style="margin-top: 20px; background: #fee2e2; border-color: #ef4444; color: #ef4444;" onclick="endSessionEarly()">
                <i class="fas fa-stop-circle"></i> End Session Early
            </button>
        </div>
        
        <!-- Typing Indicator -->
        <div class="typing-indicator" id="typingIndicator">
            <div class="typing-dots">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="main-layout">
            <!-- Sidebar -->
            <div class="sidebar">
                <div class="card">
                    <div class="card-title">
                        <i class="fas fa-book-open"></i>
                        Academic Support
                    </div>
                    <div class="quick-actions">
                        <button class="quick-btn" onclick="askQuestion('How do I manage assignment deadlines?')">
                            <i class="fas fa-tasks"></i>
                            üìù Assignment Help
                        </button>
                        <button class="quick-btn" onclick="askQuestion('Exam preparation tips')">
                            <i class="fas fa-graduation-cap"></i>
                            üéØ Exam Preparation
                        </button>
                        <button class="quick-btn" onclick="askQuestion('Study schedule for 5 subjects')">
                            <i class="fas fa-calendar-alt"></i>
                            üìÖ Study Schedule
                        </button>
                        <button class="quick-btn" onclick="askQuestion('attendance requirements')">
                            <i class="fas fa-clipboard-check"></i>
                            üìä Attendance Rules
                        </button>
                        <button class="quick-btn" onclick="askQuestion('library hours resources')">
                            <i class="fas fa-book"></i>
                            üìö Library Access
                        </button>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-title">
                        <i class="fas fa-crosshairs"></i>
                        Focus & Productivity
                    </div>
                    <div class="quick-actions">
                        <button class="quick-btn" onclick="askQuestion('how to improve concentration')">
                            <i class="fas fa-brain"></i>
                            üß† Improve Concentration
                        </button>
                        <button class="quick-btn" onclick="askQuestion('procrastination motivation study')">
                            <i class="fas fa-clock"></i>
                            ‚è∞ Beat Procrastination
                        </button>
                        <button class="quick-btn" onclick="askQuestion('Pomodoro technique')">
                            <i class="fas fa-stopwatch"></i>
                            ‚è± Pomodoro Technique
                        </button>
                        <button class="quick-btn" onclick="askQuestion('time management balance')">
                            <i class="fas fa-balance-scale"></i>
                            ‚öñÔ∏è Time Management
                        </button>
                        <button class="quick-btn" onclick="askQuestion('deep work tips')">
                            <i class="fas fa-diving-bell"></i>
                            üí° Deep Work Tips
                        </button>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-title">
                        <i class="fas fa-heart"></i>
                        Emotional Well-being
                    </div>
                    <div class="quick-actions">
                        <button class="quick-btn" onclick="askQuestion('stress anxiety exams pressure')">
                            <i class="fas fa-cloud-rain"></i>
                            üò∞ Stress Relief
                        </button>
                        <button class="quick-btn" onclick="askQuestion('homesick lonely adjustment')">
                            <i class="fas fa-home"></i>
                            üè° Homesickness
                        </button>
                        <button class="quick-btn" onclick="askQuestion('peer pressure competition')">
                            <i class="fas fa-users"></i>
                            üë• Peer Pressure
                        </button>
                        <button class="quick-btn" onclick="askQuestion('financial worries fees expenses')">
                            <i class="fas fa-money-bill-wave"></i>
                            üí∞ Financial Support
                        </button>
                    </div>
                </div>
                
                <div class="card emergency-card">
                    <div class="card-title">
                        <i class="fas fa-life-ring"></i>
                        Immediate Support
                    </div>
                    <p style="margin-bottom: 15px; color: #7f1d1d;">
                        If you're in crisis or need urgent support:
                    </p>
                    <button class="emergency-btn" onclick="showEmergency()">
                        <i class="fas fa-phone-alt"></i>
                        Get Immediate Help
                    </button>
                </div>
                
                <div class="card timetable-generator">
                    <div class="card-title">
                        <i class="fas fa-calendar-plus"></i>
                        Timetable Generator
                    </div>
                    <p>Create personalized study schedule:</p>
                    <div class="timetable-input">
                        <input type="text" id="subjectsInput" 
                               placeholder="Enter subjects (e.g., Math, Physics, DSA...)">
                        <button class="timetable-btn" onclick="generateTimetable()">
                            Generate
                        </button>
                    </div>
                    <div id="timetableResult"></div>
                </div>
            </div>
            
            <!-- Chat Area -->
            <div class="chat-area">
                <div class="chat-header">
                    <h2>
                        <i class="fas fa-comments"></i>
                        Student Support Chat
                    </h2>
                    <div class="bot-status">
                        <span class="status-indicator"></span>
                        <span id="botStatus">Connected to BMS Server</span>
                    </div>
                </div>
                
                <div class="chat-container">
                    <div class="chat-messages" id="chatMessages">
                        <!-- Messages will appear here -->
                    </div>
                    
                    <div class="chat-input-area">
                        <input type="text" 
                               class="message-input" 
                               id="messageInput"
                               placeholder="Ask about studies, stress, campus life, or anything..."
                               onkeypress="if(event.key === 'Enter') sendMessage()">
                        <button class="send-btn" onclick="sendMessage()">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Features Grid -->
        <div class="features-grid">
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-users"></i>
                </div>
                <h3>Peer Study Groups</h3>
                <p>Connect with classmates for collaborative learning sessions with progress tracking and analytics.</p>
                <button class="feature-btn" onclick="startPeerStudy()">
                    <i class="fas fa-play-circle"></i> Start Study Session
                </button>
            </div>
            
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-university"></i>
                </div>
                <h3>Campus Resources</h3>
                <p>Access library, canteen, WiFi, hostel information and all campus facilities guide with timings.</p>
                <button class="feature-btn" onclick="askQuestion('campus facilities information')">
                    <i class="fas fa-map-marked-alt"></i> Explore Campus
                </button>
            </div>
            
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-briefcase"></i>
                </div>
                <h3>Career Guidance</h3>
                <p>Get placement tips, internship opportunities and career path counseling with BMS statistics.</p>
                <button class="feature-btn" onclick="askQuestion('placement training companies')">
                    <i class="fas fa-chart-line"></i> Career Support
                </button>
            </div>
        </div>
        
        <!-- Footer -->
        <footer class="footer">
            <p>¬© 2024 BMS College of Engineering Student Support System</p>
            <p>Department of Computer Science & Engineering | Autonomous under VTU</p>
            <div class="footer-links">
                <a href="#" class="footer-link">Privacy Policy</a>
                <a href="#" class="footer-link">Terms of Use</a>
                <a href="#" class="footer-link">Contact College</a>
                <a href="#" class="footer-link">Feedback</a>
            </div>
        </footer>
    </div>
    
    <script>
        // DOM Elements
        const chatMessages = document.getElementById('chatMessages');
        const messageInput = document.getElementById('messageInput');
        const subjectsInput = document.getElementById('subjectsInput');
        const timetableResult = document.getElementById('timetableResult');
        const studySession = document.getElementById('studySession');
        const sessionIdDisplay = document.getElementById('sessionIdDisplay');
        const subjectsDisplay = document.getElementById('subjectsDisplay');
        const timerDisplay = document.getElementById('timerDisplay');
        const progressBar = document.getElementById('progressBar');
        const progressText = document.getElementById('progressText');
        const typingIndicator = document.getElementById('typingIndicator');
        const botStatus = document.getElementById('botStatus');
        
        // Backend URL configuration
        const BACKEND_URL = window.location.protocol === 'file:' ? 'http://localhost:8080' : '';
        
        let currentChart = null;
        let pollingInterval = null;
        let currentSessionId = null;
        let sessionDuration = 0;
        
        // Check backend connection on load
        window.addEventListener('load', function() {
            fetch(`${BACKEND_URL}/health`)
                .then(response => response.text())
                .then(data => {
                    botStatus.textContent = "Connected to BMS Server";
                    botStatus.style.color = "#10b981";
                    addInitialMessage();
                })
                .catch(err => {
                    botStatus.textContent = "Backend Connection Failed";
                    botStatus.style.color = "#ef4444";
                    addMessage('bot', 
                        '<div style="background: #fee2e2; padding: 15px; border-radius: 10px; border-left: 4px solid #ef4444;">' +
                        '<h4 style="color: #7f1d1d; margin-bottom: 10px;">‚ö†Ô∏è Connection Issue</h4>' +
                        '<p>Unable to connect to the BMS backend server. Please ensure the Java server is running on port 8080.</p>' +
                        '</div>'
                    );
                });
        });
        
        // Add initial bot message
        function addInitialMessage() {
            setTimeout(() => {
                addMessage('bot', 
                    'Welcome to BMS College Student Support! ü§ñ<br><br>' +
                    '<b>I\'m your comprehensive companion for:</b><br>' +
                    '‚Ä¢ üìö <b>Academic Excellence</b> - VTU syllabus, assignments, exam prep<br>' +
                    '‚Ä¢ üß† <b>Focus & Productivity</b> - Concentration, time management, deep work<br>' +
                    '‚Ä¢ üòå <b>Mental Wellness</b> - Stress relief, anxiety management, peer support<br>' +
                    '‚Ä¢ üè´ <b>Campus Life</b> - Library, hostel, facilities, events<br>' +
                    '‚Ä¢ üíº <b>Career Development</b> - Placements, internships, skill building<br>' +
                    '‚Ä¢ üë• <b>Collaborative Learning</b> - Study groups with progress tracking<br><br>' +
                    '<div class="info-cards">' +
                    '<div class="info-card"><h5>üìä Quick Stats</h5><p>92% placement rate | 1,25,000+ library books</p></div>' +
                    '<div class="info-card"><h5>üïí Library Hours</h5><p>8:30 AM - 8:30 PM (Weekdays)</p></div>' +
                    '<div class="info-card"><h5>üéØ VTU Passing</h5><p>40% aggregate | 75% attendance required</p></div>' +
                    '</div>' +
                    '<br>How can I support your academic journey today?'
                );
            }, 1000);
        }
        
        // Add message to chat
        function addMessage(sender, content, type = 'normal') {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}-message`;
            
            const time = new Date().toLocaleTimeString([], { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            
            let headerContent = '';
            if (sender === 'bot') {
                headerContent = `
                    <div class="message-header">
                        <i class="fas fa-robot"></i>
                        <span>BMS Companion</span>
                    </div>
                `;
            } else {
                headerContent = `
                    <div class="message-header">
                        <span>You</span>
                        <i class="fas fa-user-graduate"></i>
                    </div>
                `;
            }
            
            // Determine message type for styling
            let messageType = '';
            if (content.includes('<table') || content.includes('<div style=') || content.includes('<h3') || content.includes('<ul>')) {
                messageType = 'special';
            }
            
            messageDiv.innerHTML = `
                ${headerContent}
                <div class="message-content ${messageType}">
                    ${content}
                </div>
                <div class="message-time">${time}</div>
            `;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // Hide typing indicator
            typingIndicator.style.display = 'none';
        }
        
        // Show typing indicator
        function showTyping() {
            typingIndicator.style.display = 'block';
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        // Send message
        function sendMessage() {
            const message = messageInput.value.trim();
            if (!message) return;
            
            addMessage('user', message);
            messageInput.value = '';
            showTyping();
            
            // Send to backend
            fetch(`${BACKEND_URL}/chat?message=${encodeURIComponent(message)}`)
                .then(res => {
                    if (!res.ok) throw new Error('Network response was not ok');
                    return res.text();
                })
                .then(response => {
                    addMessage('bot', response);
                })
                .catch(err => {
                    addMessage('bot', 
                        '<div style="background: #fee2e2; padding: 15px; border-radius: 10px; border-left: 4px solid #ef4444;">' +
                        '<h4 style="color: #7f1d1d; margin-bottom: 10px;">‚ö†Ô∏è Network Error</h4>' +
                        '<p>Could not connect to the server. Please try again or check your internet connection.</p>' +
                        '</div>'
                    );
                });
        }
        
        // Ask predefined question
        function askQuestion(question) {
            messageInput.value = question;
            sendMessage();
        }
        
        // Show emergency resources
        function showEmergency() {
            askQuestion('emergency contacts crisis support');
        }
        
        // Generate timetable
        function generateTimetable() {
            const input = subjectsInput.value.trim();
            const subjects = input.split(/[,\s]+/).filter(s => s.length > 0);
            
            if (subjects.length < 2 || subjects.length > 6) {
                alert('Please enter 2 to 6 subjects (e.g., Math, Physics, Chemistry, DSA, Java)');
                return;
            }
            
            addMessage('user', `Generate timetable for: ${subjects.join(', ')}`);
            showTyping();
            
            fetch(`${BACKEND_URL}/generate-timetable?subjects=${encodeURIComponent(subjects.join(','))}`)
                .then(res => res.text())
                .then(timetable => {
                    addMessage('bot', timetable);
                    
                    // Scroll timetable into view
                    const lastMessage = chatMessages.lastElementChild;
                    if (lastMessage) {
                        lastMessage.scrollIntoView({ behavior: 'smooth' });
                    }
                })
                .catch(err => {
                    addMessage('bot', 'Could not generate timetable. Please try again.');
                });
        }
        
        // Start Peer Study Session
        function startPeerStudy() {
            const minutes = prompt('Enter study duration in minutes (e.g., 50):', '50');
            if (!minutes || isNaN(minutes) || minutes <= 0 || minutes > 240) {
                alert('Please enter a valid number between 1 and 240 minutes.');
                return;
            }
            
            const subjects = prompt('Enter subjects (comma separated, e.g., Math, Physics, DSA):', 'Math, Physics, DSA');
            let subjectsArray = [];
            if (subjects && subjects.trim()) {
                subjectsArray = subjects.split(/[,\s]+/).filter(s => s.length > 0);
            }
            
            addMessage('user', `Start ${minutes}-minute peer study session for: ${subjectsArray.join(', ') || 'general study'}`);
            showTyping();
            
            let url = `${BACKEND_URL}/peer-study?minutes=${minutes}`;
            if (subjectsArray.length > 0) {
                url += `&subjects=${encodeURIComponent(subjectsArray.join(','))}`;
            }
            
            fetch(url)
                .then(res => res.text())
                .then(html => {
                    // Extract session ID
                    let sessionId = null;
                    const idMatch = html.match(/Session ID:<\/b>\s*([A-Z0-9]{6})/);
                    if (idMatch && idMatch[1]) {
                        sessionId = idMatch[1];
                    }
                    
                    // Fallback to generate session ID
                    if (!sessionId) {
                        sessionId = Math.random().toString(36).substring(2, 8).toUpperCase();
                    }
                    
                    addMessage('bot', html, 'peer');
                    
                    // Initialize study dashboard
                    initStudyDashboard(sessionId, parseInt(minutes), subjectsArray);
                    
                    // Auto-generate report after session
                    setTimeout(() => {
                        if (currentSessionId === sessionId) {
                            generateReport(sessionId);
                        }
                    }, minutes * 60 * 1000);
                })
                .catch(err => {
                    addMessage('bot', 'Error starting study session. Please try again.');
                });
        }
        
        // Initialize study dashboard with polling and chart
        function initStudyDashboard(sessionId, durationMinutes, subjects) {
            currentSessionId = sessionId;
            sessionDuration = durationMinutes;
            sessionIdDisplay.textContent = sessionId;
            subjectsDisplay.textContent = subjects.length > 0 ? subjects.join(', ') : 'General Study';
            studySession.style.display = 'block';
            studySession.scrollIntoView({ behavior: 'smooth' });
            
            // Initialize Chart
            const ctx = document.getElementById('progressChart').getContext('2d');
            if (currentChart) {
                currentChart.destroy();
            }
            
            currentChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['0'],
                    datasets: [{
                        label: 'Progress (%)',
                        data: [0],
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#065f46',
                        pointRadius: 5,
                        pointHoverRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                        }
                    },
                    scales: {
                        y: {
                            min: 0,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Progress %',
                                color: '#065f46',
                                font: {
                                    weight: 'bold'
                                }
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.05)'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Elapsed Minutes',
                                color: '#065f46',
                                font: {
                                    weight: 'bold'
                                }
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.05)'
                            }
                        }
                    }
                }
            });
            
            // Start polling for progress updates
            if (pollingInterval) clearInterval(pollingInterval);
            pollingInterval = setInterval(() => {
                updateStudyProgress(sessionId, durationMinutes);
            }, 2000); // Poll every 2 seconds
        }
        
        // Update study progress
        function updateStudyProgress(sessionId, durationMinutes) {
            fetch(`${BACKEND_URL}/study-progress?sessionId=${sessionId}`)
                .then(res => {
                    if (!res.ok) {
                        throw new Error('Session not found');
                    }
                    return res.json();
                })
                .then(data => {
                    if (data.error) {
                        clearInterval(pollingInterval);
                        return;
                    }
                    
                    const remaining = data.remainingSeconds || 0;
                    const progress = Math.round(data.progress || 0);
                    const elapsedMinutes = Math.round((durationMinutes * 60 - remaining) / 60);
                    
                    // Update timer
                    const mins = Math.floor(remaining / 60).toString().padStart(2, '0');
                    const secs = (remaining % 60).toString().padStart(2, '0');
                    timerDisplay.textContent = `${mins}:${secs}`;
                    
                    // Update progress bar and text
                    progressBar.style.width = `${progress}%`;
                    progressText.textContent = `${progress}%`;
                    
                    // Update chart
                    if (elapsedMinutes > currentChart.data.labels.length - 1 || 
                        (progress > 0 && progress !== currentChart.data.datasets[0].data[currentChart.data.datasets[0].data.length - 1])) {
                        
                        currentChart.data.labels.push(elapsedMinutes.toString());
                        currentChart.data.datasets[0].data.push(progress);
                        
                        // Keep only last 20 data points
                        if (currentChart.data.labels.length > 20) {
                            currentChart.data.labels.shift();
                            currentChart.data.datasets[0].data.shift();
                        }
                        
                        currentChart.update('none');
                    }
                    
                    // Check if completed
                    if (progress >= 100 || remaining <= 0) {
                        clearInterval(pollingInterval);
                        generateReport(sessionId);
                    }
                })
                .catch(err => {
                    console.log('Polling error:', err);
                });
        }
        
        // Generate report
        function generateReport(sessionId) {
            fetch(`${BACKEND_URL}/generate-report?sessionId=${sessionId}`)
                .then(res => res.text())
                .then(report => {
                    addMessage('bot', report, 'special');
                    studySession.style.display = 'none';
                    clearInterval(pollingInterval);
                    currentSessionId = null;
                    
                    // Ask if user wants to start another session
                    setTimeout(() => {
                        addMessage('bot', 
                            '<div style="background: #f0f9ff; padding: 15px; border-radius: 10px; border-left: 4px solid #0ea5e9;">' +
                            '<h4 style="color: #0369a1; margin-bottom: 10px;">üéâ Session Complete!</h4>' +
                            '<p>Would you like to start another study session or review your progress?</p>' +
                            '<button style="background: #0ea5e9; color: white; border: none; padding: 8px 16px; border-radius: 5px; margin-right: 10px; cursor: pointer;" onclick="startPeerStudy()">Start New Session</button>' +
                            '</div>'
                        );
                    }, 1000);
                })
                .catch(err => {
                    addMessage('bot', 'Could not generate report. Session may have already ended.');
                    studySession.style.display = 'none';
                    currentSessionId = null;
                });
        }
        
        // End session early
        function endSessionEarly() {
            if (!currentSessionId || !confirm('End this study session early and generate report?')) return;
            
            if (pollingInterval) {
                clearInterval(pollingInterval);
            }
            generateReport(currentSessionId);
        }
        
        // Auto-focus on input and add keyboard shortcuts
        messageInput.focus();
        
        // Add keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Ctrl + / to focus input
            if (e.ctrlKey && e.key === '/') {
                e.preventDefault();
                messageInput.focus();
            }
            
            // Escape to clear input
            if (e.key === 'Escape') {
                messageInput.value = '';
            }
        });
        
        // Add smooth scrolling for chat
        chatMessages.addEventListener('DOMNodeInserted', function() {
            this.scrollTop = this.scrollHeight;
        });
    </script>
</body>
</html>